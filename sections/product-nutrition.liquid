{% comment %}
  Product Nutrition Information Section - Tabbed interface
{% endcomment %}

<section class="product-nutrition">
  <div class="product-nutrition__container">
    {% if section.settings.title != blank %}
      <h2 class="product-nutrition__title">{{ section.settings.title }}</h2>
    {% endif %}
    
    <div class="product-nutrition__tabs">
      <button 
        type="button" 
        class="product-nutrition__tab active" 
        data-tab="nutrition"
        aria-selected="true"
      >
        Nutrition Facts
      </button>
      <button 
        type="button" 
        class="product-nutrition__tab" 
        data-tab="ingredients"
        aria-selected="false"
      >
        Ingredients
      </button>
      <button 
        type="button" 
        class="product-nutrition__tab" 
        data-tab="allergens"
        aria-selected="false"
      >
        Allergens
      </button>
    </div>
    
    <div class="product-nutrition__content">
      <div class="product-nutrition__panel active" data-panel="nutrition" aria-hidden="false">
        {% if section.settings.nutrition_facts != blank %}
          <div class="nutrition-facts">
            {{ section.settings.nutrition_facts }}
          </div>
        {% else %}
          <div class="nutrition-facts">
            <div class="nutrition-facts__header">
              <h3>Nutrition Facts</h3>
              <p class="nutrition-facts__serving">Serving Size: {{ section.settings.serving_size | default: "1 scoop (10g)" }}</p>
            </div>
            <table class="nutrition-facts__table">
              <tbody>
                {% if section.settings.calories != blank %}
                  <tr>
                    <td class="nutrition-facts__label">Calories</td>
                    <td class="nutrition-facts__value">{{ section.settings.calories }}</td>
                  </tr>
                {% endif %}
                {% if section.settings.protein != blank %}
                  <tr>
                    <td class="nutrition-facts__label">Protein</td>
                    <td class="nutrition-facts__value">{{ section.settings.protein }}g</td>
                  </tr>
                {% endif %}
                {% if section.settings.carbs != blank %}
                  <tr>
                    <td class="nutrition-facts__label">Total Carbohydrates</td>
                    <td class="nutrition-facts__value">{{ section.settings.carbs }}g</td>
                  </tr>
                {% endif %}
                {% if section.settings.fiber != blank %}
                  <tr>
                    <td class="nutrition-facts__label">Dietary Fiber</td>
                    <td class="nutrition-facts__value">{{ section.settings.fiber }}g</td>
                  </tr>
                {% endif %}
                {% if section.settings.fat != blank %}
                  <tr>
                    <td class="nutrition-facts__label">Total Fat</td>
                    <td class="nutrition-facts__value">{{ section.settings.fat }}g</td>
                  </tr>
                {% endif %}
              </tbody>
            </table>
          </div>
        {% endif %}
      </div>
      
      <div class="product-nutrition__panel" data-panel="ingredients" aria-hidden="true">
        {% if section.settings.ingredients != blank %}
          <div class="ingredients-list">
            <h3>Ingredients</h3>
            <div class="ingredients-list__content">
              {{ section.settings.ingredients }}
            </div>
          </div>
        {% else %}
          <div class="ingredients-list">
            <h3>Ingredients</h3>
            <p>100% pure fruit/vegetable powder. No additives, preservatives, or fillers.</p>
          </div>
        {% endif %}
      </div>
      
      <div class="product-nutrition__panel" data-panel="allergens" aria-hidden="true">
        {% if section.settings.allergen_info != blank %}
          <div class="allergen-info">
            <h3>Allergen Information</h3>
            <div class="allergen-info__content">
              {{ section.settings.allergen_info }}
            </div>
          </div>
        {% else %}
          <div class="allergen-info">
            <h3>Allergen Information</h3>
            <p>This product is free from common allergens. Processed in a facility that may handle nuts, dairy, and soy.</p>
          </div>
        {% endif %}
        
        {% if section.settings.dietary_certifications.size > 0 %}
          <div class="dietary-certifications">
            <h4>Dietary Certifications</h4>
            <div class="dietary-certifications__badges">
              {% for certification in section.settings.dietary_certifications %}
                <span class="dietary-badge">{{ certification }}</span>
              {% endfor %}
            </div>
          </div>
        {% endif %}
      </div>
    </div>
  </div>
</section>

{% stylesheet %}
  .product-nutrition {
    width: 100%;
    max-width: 100%;
    padding: var(--spacing-5xl) var(--spacing-lg);
    background: linear-gradient(135deg, rgba(74, 124, 44, 0.02) 0%, rgba(212, 175, 55, 0.02) 100%);
    box-sizing: border-box;
  }

  .product-nutrition__container {
    max-width: 1000px;
    margin: 0 auto;
  }

  .product-nutrition__title {
    text-align: center;
    font-family: var(--font-heading);
    font-size: clamp(36px, 4.5vw, 56px);
    font-weight: 900;
    background: linear-gradient(135deg, var(--forest-green) 0%, var(--sage-green) 100%);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
    margin-bottom: var(--spacing-4xl);
    letter-spacing: -0.02em;
    line-height: 1.2;
    padding: 10px;
    margin-top: var(--spacing-2xl);
  }

  .product-nutrition__tabs {
    display: flex;
    gap: var(--spacing-sm);
    margin-bottom: var(--spacing-2xl);
    border-bottom: 2px solid rgba(74, 124, 44, 0.1);
    flex-wrap: wrap;
  }

  .product-nutrition__tab {
    padding: var(--spacing-md) var(--spacing-xl);
    background: transparent;
    border: none;
    border-bottom: 3px solid transparent;
    font-size: var(--body-normal);
    font-weight: 600;
    color: var(--text);
    cursor: pointer;
    transition: all 0.3s ease;
    position: relative;
    bottom: -2px;
  }

  .product-nutrition__tab:hover {
    color: var(--forest-green);
  }

  .product-nutrition__tab.active {
    color: var(--forest-green);
    border-bottom-color: var(--gold);
  }

  .product-nutrition__content {
    position: relative;
    min-height: 300px;
  }

  .product-nutrition__panel {
    display: none;
    animation: fadeIn 0.4s ease;
  }

  .product-nutrition__panel.active {
    display: block;
  }

  @keyframes fadeIn {
    from {
      opacity: 0;
      transform: translateY(10px);
    }
    to {
      opacity: 1;
      transform: translateY(0);
    }
  }

  .nutrition-facts {
    background: var(--white);
    padding: var(--spacing-2xl);
    border-radius: var(--radius-xl);
    box-shadow: 0 4px 20px rgba(45, 80, 22, 0.08);
  }

  .nutrition-facts__header {
    margin-bottom: var(--spacing-lg);
    padding-bottom: var(--spacing-md);
    border-bottom: 2px solid rgba(74, 124, 44, 0.1);
  }

  .nutrition-facts__header h3 {
    font-family: var(--font-heading);
    font-size: var(--h3-size);
    color: var(--forest-green);
    margin-bottom: var(--spacing-xs);
  }

  .nutrition-facts__serving {
    font-size: var(--body-small);
    color: #666;
    margin: 0;
  }

  .nutrition-facts__table {
    width: 100%;
    border-collapse: collapse;
  }

  .nutrition-facts__table tr {
    border-bottom: 1px solid rgba(74, 124, 44, 0.1);
  }

  .nutrition-facts__table tr:last-child {
    border-bottom: none;
  }

  .nutrition-facts__label {
    padding: var(--spacing-md) var(--spacing-md) var(--spacing-md) 0;
    font-weight: 600;
    color: var(--text);
    text-align: left;
  }

  .nutrition-facts__value {
    padding: var(--spacing-md) 0;
    font-weight: 700;
    color: var(--forest-green);
    text-align: right;
  }

  .ingredients-list,
  .allergen-info {
    background: var(--white);
    padding: var(--spacing-2xl);
    border-radius: var(--radius-xl);
    box-shadow: 0 4px 20px rgba(45, 80, 22, 0.08);
  }

  .ingredients-list h3,
  .allergen-info h3 {
    font-family: var(--font-heading);
    font-size: var(--h3-size);
    color: var(--forest-green);
    margin-bottom: var(--spacing-lg);
  }

  .ingredients-list__content {
    font-size: var(--body-large);
    line-height: 1.8;
    color: var(--text);
  }

  .allergen-info__content {
    font-size: var(--body-normal);
    line-height: 1.7;
    color: var(--text);
    margin-bottom: var(--spacing-xl);
  }

  .dietary-certifications {
    margin-top: var(--spacing-xl);
    padding-top: var(--spacing-xl);
    border-top: 1px solid rgba(74, 124, 44, 0.1);
  }

  .dietary-certifications h4 {
    font-family: var(--font-heading);
    font-size: var(--h4-size);
    color: var(--forest-green);
    margin-bottom: var(--spacing-md);
  }

  .dietary-certifications__badges {
    display: flex;
    flex-wrap: wrap;
    gap: var(--spacing-sm);
  }

  .dietary-badge {
    padding: var(--spacing-xs) var(--spacing-md);
    background: linear-gradient(135deg, rgba(74, 124, 44, 0.1) 0%, rgba(212, 175, 55, 0.1) 100%);
    border: 2px solid var(--sage-green);
    border-radius: var(--radius-full);
    font-size: var(--body-small);
    font-weight: 600;
    color: var(--forest-green);
  }

  @media (max-width: 768px) {
    .product-nutrition__tabs {
      flex-direction: column;
      border-bottom: none;
    }

    .product-nutrition__tab {
      border-bottom: 2px solid rgba(74, 124, 44, 0.1);
      border-left: 3px solid transparent;
      border-right: none;
      text-align: left;
    }

    .product-nutrition__tab.active {
      border-left-color: var(--gold);
      border-bottom-color: rgba(74, 124, 44, 0.1);
    }
  }
{% endstylesheet %}

{% javascript %}
  document.addEventListener('DOMContentLoaded', function() {
    const tabs = document.querySelectorAll('.product-nutrition__tab');
    const panels = document.querySelectorAll('.product-nutrition__panel');
    
    tabs.forEach(tab => {
      tab.addEventListener('click', function() {
        const targetTab = this.dataset.tab;
        
        // Update tabs
        tabs.forEach(t => {
          t.classList.remove('active');
          t.setAttribute('aria-selected', 'false');
        });
        this.classList.add('active');
        this.setAttribute('aria-selected', 'true');
        
        // Update panels
        panels.forEach(panel => {
          panel.classList.remove('active');
          panel.setAttribute('aria-hidden', 'true');
          if (panel.dataset.panel === targetTab) {
            panel.classList.add('active');
            panel.setAttribute('aria-hidden', 'false');
          }
        });
      });
    });
  });
{% endjavascript %}

{% schema %}
{
  "name": "Product Nutrition",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Nutrition Information"
    },
    {
      "type": "text",
      "id": "serving_size",
      "label": "Serving Size",
      "default": "1 scoop (10g)"
    },
    {
      "type": "richtext",
      "id": "nutrition_facts",
      "label": "Nutrition Facts (HTML)",
      "info": "Leave blank to use individual fields below"
    },
    {
      "type": "text",
      "id": "calories",
      "label": "Calories"
    },
    {
      "type": "text",
      "id": "protein",
      "label": "Protein (g)"
    },
    {
      "type": "text",
      "id": "carbs",
      "label": "Total Carbohydrates (g)"
    },
    {
      "type": "text",
      "id": "fiber",
      "label": "Dietary Fiber (g)"
    },
    {
      "type": "text",
      "id": "fat",
      "label": "Total Fat (g)"
    },
    {
      "type": "richtext",
      "id": "ingredients",
      "label": "Ingredients List"
    },
    {
      "type": "richtext",
      "id": "allergen_info",
      "label": "Allergen Information"
    },
    {
      "type": "text",
      "id": "dietary_certifications",
      "label": "Dietary Certifications",
      "info": "Comma-separated list (e.g., Organic, Vegan, Gluten-Free)"
    }
  ],
  "presets": [
    {
      "name": "Product Nutrition"
    }
  ]
}
{% endschema %}
